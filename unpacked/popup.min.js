/*! hobookmarks - v0.2.0 - 2016-09-26 */document.addEventListener("DOMContentLoaded",function(){document.getElementById("btn_upload").addEventListener("click",bmark.uploadBookmarks),document.getElementById("btn_download").addEventListener("click",bmark.downloadBookmarks),document.getElementById("server_url").addEventListener("keyup",function(a){13===a.keyCode&&bmark.updateServerUrl()})});var bmark=function(){function a(){b(),i()}function b(){chrome.bookmarks.search({title:"H&O"},function(a){a=a.filter(function(a){return"1"===a.parentId&&"H&O"===a.title}),0===a.length?c():1===a.length?(k=a[0],h()):message.render('Existe m√°s de una carpeta "H&O" en la barra de marcadores',1e4)})}function c(a){chrome.bookmarks.create({parentId:"1",title:"H&O"},function(b){k=b,a&&a()})}function d(){l=[],e(function(a){chrome.bookmarks.removeTree(k.id,function(){c(function(){g(a,null)})})})}function e(a){var b=new XMLHttpRequest;b.onreadystatechange=function(){4===b.readyState&&200===b.status&&(console.log(JSON.parse(b.responseText)),a(JSON.parse(b.responseText)))},b.open("GET","http://"+m+"/read",!0),b.send()}function f(){var a=new XMLHttpRequest;a.onreadystatechange=function(){1===a.readyState&&message.render("Hecho!",0)},a.open("POST","http://"+m+"/write"),a.setRequestHeader("Content-Type","application/json;charset=UTF-8"),a.send(JSON.stringify(l))}function g(a,b){var c=b?b.id:k.id;a.forEach(function(a){a.dateGroupModified?chrome.bookmarks.create({parentId:c,title:a.title},function(b){g(a.children,b)}):chrome.bookmarks.create({parentId:c,title:a.title,url:a.url})})}function h(){chrome.bookmarks.getChildren(k.id,function(a){l=a,a.filter(function(a){return a.dateGroupModified}).forEach(function(a){chrome.bookmarks.getChildren(a.id,function(a){a.forEach(function(a){l.push(a)})})})})}function i(){storage.loadServerAddr(function(a){a&&""!==a?(m=a,document.getElementById("server_url").value=m):j()})}function j(){var a=document.getElementById("server_url").value;""!==a&&(m=a,storage.saveServerAddr(m))}var k=null,l=[],m="localhost:8080";return{init:a,uploadBookmarks:f,downloadBookmarks:d,updateServerUrl:j}}(),storage=function(){function a(a){chrome.storage.sync.set({server:a},function(){})}function b(a){chrome.storage.sync.get("server",function(b){a(b.server)})}return{saveServerAddr:a,loadServerAddr:b}}(),message=function(){var a=document.createElement("p");a.innerHTML="Click para cerrar";var b;document.addEventListener("DOMContentLoaded",function(){b=document.getElementById("display"),b.addEventListener("click",function(){b.classList.remove("visible")})});var c=function(c,d){b.innerHTML=c,b.appendChild(a),b.classList.add("visible"),d&&setTimeout(function(){b.innerHTML="",b.classList.remove("visible")},d)};return{render:c}}();bmark.init();